var wpslAddons=wpslAddons||{};function wpslWidget(){wpslAddons.widget.init()}wpslAddons.widget={init:function(){jQuery("#wpsl-widget-search").length&&"undefined"!=typeof wpslWidgetSettings&&(1==wpslWidgetSettings.autoComplete&&wpslAddons.widget.api.autoComplete.init(),1!=wpslWidgetSettings.autoLocate||jQuery(".wpsl-search").hasClass("wpsl-widget")||wpslAddons.widget.api.geoLocationRequest()),jQuery(".wpsl-icon-direction").on("click",(function(){wpslAddons.widget.api.geoLocationRequest()})),jQuery("#wpsl-widget-submit").bind("click",(function(e){if(!jQuery.trim(jQuery("#wpsl-widget-search").val()).length)return jQuery("#wpsl-widget-search").addClass("wpsl-error").focus(),!1;jQuery("#wpsl-widget-search").removeClass("wpsl-error")}))},api:{autoComplete:{init:function(){const e=this.current;if("legacy"===wpslWidgetSettings.apiVersion)wpslAddons.widget.api.autoComplete.makeLegacyRequest();else{jQuery(document).on("keydown.wpslAutocomplete",(function(e){"Escape"===e.key&&jQuery(".wpsl-autocomplete-search-results").hide()}));for(const t in wpslWidgetSettings.placesApiOptions)if(wpslWidgetSettings.placesApiOptions.hasOwnProperty(t)){const s=wpslWidgetSettings.placesApiOptions[t];""!==s&&null!=s&&(e.request[t]=s)}e.refreshToken(),jQuery("#wpsl-widget-search").on("input",e.makeRequest)}},current:{request:{input:""},newestRequestId:0,makeRequest:async function(e){const t=e.target.value.trim(),s=wpslAddons.widget.api.autoComplete;try{if(""==t)return void jQuery(".wpsl-widget-autocomplete-search-results").find("ul").empty().end().hide();s.current.request.input=t;const e=++s.current.newestRequestId,{suggestions:o}=await google.maps.places.AutocompleteSuggestion.fetchAutocompleteSuggestions(s.current.request);if(e!==s.current.newestRequestId)return;if(!jQuery(".wpsl-widget-autocomplete-search-container").length){jQuery("#wpsl-widget-search").wrap('<div class="wpsl-widget-autocomplete-search-container"></div>');const e='<div class="wpsl-widget-autocomplete-search-results">\n            <ul>\n            </ul>\n        </div>';jQuery("#wpsl-widget-search").after(e),jQuery("#wpsl-widget-search").focus()}if(o.length>0){jQuery(".wpsl-widget-autocomplete-search-results").show();const e=jQuery("#wpsl-widget-search").outerWidth();jQuery(".wpsl-widget-autocomplete-search-results").outerWidth(e)}else jQuery(".wpsl-widget-autocomplete-search-results").hide();jQuery(".wpsl-widget-autocomplete-search-results ul").empty();for(const e of o){const o=e.placePrediction,i=o.text.toString(),n=t.toLowerCase().replace(/[^a-z0-9\s'-,]/gi,""),r=jQuery("<a>"),l=jQuery("<li>").attr("role","option").attr("tabindex","0");l.on("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),s.current.onPlaceSelected(o.toPlace()))})),l.on("click",(()=>{s.current.onPlaceSelected(o.toPlace())}));const a=i.toLowerCase().indexOf(n),c=i.slice(0,a),p=i.slice(a,a+n.length),d=i.slice(a+n.length);r.html(c+'<span class="wpsl-widget-autocomplete-highlight">'+p+"</span>"+d),l.append(r),jQuery(".wpsl-widget-autocomplete-search-results ul").append(l)}}catch(e){jQuery("#wpsl-widget-search").off("input",s.current.makeRequest),s.makeLegacyRequest()}},onPlaceSelected:async function(e){await e.fetchFields({fields:["formattedAddress","location"]}),jQuery("#wpsl-widget-search").val(e.formattedAddress),jQuery(".wpsl-widget-autocomplete-search-results").hide(),wpslAddons.widget.api.autoComplete.current.refreshToken()},refreshToken:function(){wpslAddons.widget.api.autoComplete.current.request.sessionToken=new google.maps.places.AutocompleteSessionToken}},makeLegacyRequest:function(){let e={};if(void 0===wpslWidgetSettings.geocodeComponents||jQuery.isEmptyObject(wpslWidgetSettings.geocodeComponents)||(e.componentRestrictions=wpslWidgetSettings.geocodeComponents),void 0!==wpslWidgetSettings.autoCompleteOptions&&!jQuery.isEmptyObject(wpslWidgetSettings.autoCompleteOptions))for(var t in wpslWidgetSettings.autoCompleteOptions)wpslWidgetSettings.autoCompleteOptions.hasOwnProperty(t)&&(e[t]=wpslWidgetSettings.autoCompleteOptions[t]);const s=document.getElementById("wpsl-widget-search");new google.maps.places.Autocomplete(s,e)}},geoLocationRequest:function(){var e,t,s=Number(wpslWidgetSettings.geoLocationTimout);navigator.geolocation&&(e=setInterval((function(){jQuery(".wpsl-icon-direction").toggleClass("wpsl-active-icon")}),600),navigator.geolocation.getCurrentPosition((function(s){void 0!==s&&(t=new google.maps.LatLng(s.coords.latitude,s.coords.longitude),clearInterval(e),wpslAddons.widget.api.geocode.reverse(t))}),(function(t){switch(t.code){case t.PERMISSION_DENIED:alert(wpslGeolocationErrors.denied);break;case t.POSITION_UNAVAILABLE:alert(wpslGeolocationErrors.unavailable);break;case t.TIMEOUT:alert(wpslGeolocationErrors.timeout);break;default:alert(wpslGeolocationErrors.generalError)}clearInterval(e),jQuery(".wpsl-icon-direction").removeClass("wpsl-active-icon")}),{maximumAge:6e4,timeout:s,enableHighAccuracy:!0}))},geocode:{reverse:function(e){(new google.maps.Geocoder).geocode({latLng:e},(function(e,t){e=wpslAddons.widget.api.geocode.filterResponse(e),t==google.maps.GeocoderStatus.OK&&jQuery("#wpsl-widget-search").val(e)}))},filterResponse:function(e){var t,s,o,i,n=wpslWidgetSettings.filterPattern;if("formatted_address"==n)o=e[0].formatted_address;else{for(i=e[0].address_components.length,s=0;s<i;s++)t=e[0].address_components[s].types,n.indexOf(t[0])>-1&&(o=e[0].address_components[s].long_name);o||(o=e[0].formatted_address)}return o}}}};